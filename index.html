<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>$how me the money</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>포트폴리오 백테스트</h1>
    <div class="container">
        <div class="form-container">
            <h3>설정</h3>
            <form id="backtestForm">
                <label for="strategy">전략:</label>
                <select id="strategy">
                    <option value="default" selected>정적 비중 (Default)</option>
                    <option value="laa">LAA</option>
                    <option value="haa">HAA</option>
                    <option value="daa">DAA</option>
                </select>

                <div class="stock-section">
                    <h4>종목 및 비중</h4>
                    <div id="sliders-container"></div>
                    <div class="portfolio-actions">
                        <button type="button" id="savePortfolioBtn">현재 포트폴리오 저장</button>
                        <button type="button" id="loadPortfolioBtn">불러오기</button>
                        <button type="button" id="sharePortfolioBtn">공유하기</button>
                    </div>
                    <h4>종목 검색</h4>
                    <input type="search" id="symbolSearch" placeholder="종목명 입력 (예: Apple)">
                    <ul id="search-results"></ul>
                </div>

                <label for="start_date">시작일:</label>
                <input type="date" id="start_date" value="2021-01-01">
                <label for="end_date">종료일:</label>
                <input type="date" id="end_date" value="2025-10-10">
                
                <!-- [수정] type을 'text'로 변경하고 inputmode 추가 -->
                <label for="capital">초기 투자금:</label>
                <input type="text" id="capital" value="500,000" inputmode="numeric">
                <label for="periodic_investment">주기별 추가 투자금:</label>
                <input type="text" id="periodic_investment" value="500,000" inputmode="numeric">

                <label for="interval">리밸런싱 주기:</label>
                <select id="interval">
                    <option value="1M">매월 (1M)</option>
                    <option value="3M" selected>매분기 (3M)</option>
                    <option value="6M">매반기 (6M)</option>
                    <option value="1Y">매년 (1Y)</option>
                </select>
                <label for="no_rebalance">리밸런싱 안함:</label>
                <input type="checkbox" id="no_rebalance" style="width: auto;">
                <label for="no_drip">배당 재투자 안 함:</label>
                <input type="checkbox" id="no_drip" style="width: auto;">
                <hr>
                <label for="rolling_window">롤링 기간 (연):</label>
                <input type="number" id="rolling_window" placeholder="예: 3 (미입력 시 계산 안함)" value="3">
                <label for="rolling_step">롤링 주기:</label>
                <select id="rolling_step">
                    <option value="1Y" selected>매년 (1Y)</option>
                    <option value="1Q">매분기 (1Q)</option>
                    <option value="1M">매월 (1M)</option>
                </select>
                <hr>
                <button type="submit" id="submitButton">백테스트 실행</button>
                <p id="status"></p>
            </form>
        </div>
        <div class="chart-container">
            <h3 id="chartTitle">결과 차트</h3>
            <canvas id="backtestChart"></canvas>
        </div>
    </div>
    
    <!-- 이하 HTML 구조는 변경 없음 -->
    <div class="holdings-container" style="display: none;">
        <h3>포트폴리오 현황</h3>
        <table id="holdingsTable">
            <thead id="holdingsTableHeader"></thead>
            <tbody id="holdingsTableBody"></tbody>
        </table>
    </div>
    <div class="rolling-returns-container" style="display: none;">
        <h3>롤링 리턴 (Rolling Returns)</h3>
        <table id="rollingReturnsTable">
            <thead>
                <tr><th>시작일</th><th>종료일</th><th>연평균수익률 (CAGR)</th></tr>
            </thead>
            <tbody id="rollingReturnsTableBody"></tbody>
        </table>
        <div id="rollingReturnsSummary"></div>
    </div>
    <div class="log-container">
        <h3>백테스트 로그</h3>
        <table id="logTable">
            <thead>
                <tr><th>날짜</th><th>이벤트 종류</th><th>상세 내용</th></tr>
            </thead>
            <tbody id="logTableBody"></tbody>
        </table>
    </div>
    <div id="shareModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="modal-close-btn">&times;</span>
            <h3>포트폴리오 공유</h3>
            <p>아래 URL을 복사하여 다른 사람에게 공유하세요.</p>
            <div class="share-url-container">
                <input type="text" id="shareUrlInput" readonly>
                <button id="copyUrlBtn">복사</button>
            </div>
            <div id="qrcode"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>

